<html>
<head>

</head>
<body style="padding: 0; margin: 0">


<canvas id="canvas" width="800" height="600" 
	style="
		width: 100%; height: 100%;
		grid-column: 1; grid-row: 1">
</canvas>

<span style="position: fixed; z-index: 100; left: 10px; top: 10px;">
	
</span>

<script src="./libs/gl-matrix.js"></script>
<script src="./libs/dat.gui.min.js"></script>


<script type="module" async>
	
	import {PotreeLoader} from "./src/octree/PotreeLoader.js";
	import {Geometry} from "./src/Geometry.js";
	import {Mesh} from "./src/scene/Mesh.js";
	import {Vector3} from "./src/math/Vector3.js";
	import {Lines} from "./src/scene/Lines.js";
	import {Potree} from "./src/Potree.js";


	window.debug = {
		"#nodes": "0",
		"#points": "0",
		fps: "0",
		displayBoxes: false,
		freeze: false,
		attribute: "rgb",
		minNodeSize: 0.2,
	};

	window.onload = function() {
		let gui = new dat.GUI();
		// gui.add(text, 'message');
		// gui.add(text, 'speed', -5, 5);
		//gui.add(debug, 'fps');

		gui.add(debug, '#nodes').listen();
		gui.add(debug, '#points').listen();
		gui.add(debug, 'fps').listen();
		gui.add(debug, 'displayBoxes');
		gui.add(debug, 'freeze');
		gui.add(debug, 'attribute', { rgb: "rgb", intensity: "intensity"});
		gui.add(debug, 'minNodeSize', 0.01, 0.5);
		// gui.add(text, 'explode');
	};


	let canvas = document.getElementById("canvas");
	new Potree().init(canvas).then((viewer) => {
		window.potree = viewer;
		
		let scene = viewer.scene;
		window.scene = scene;

		// let box = Geometry.createBox();
		// let node = new Mesh("box", box);
		// scene.root.add(node);

		// let node2 = new Mesh("box2", box);
		// node2.position.set(1, 1, -0.3);
		// node2.scale.set(0.5, 0.5, 0.5);
		// scene.root.add(node2);

		// viewer.controls.yaw = 0.846118694223537;
		// viewer.controls.pitch = -0.540115107486389;
		// viewer.controls.radius = 1077.8585227511016;
		// viewer.controls.target.set(693889.3707829863, 3915957.049240404, 25.668688479273722);

		// eclepens
		viewer.controls.yaw = 0.6146611737189656;
		viewer.controls.pitch = -0.6617165745778338;
		viewer.controls.radius = 801.7953205361365;
		viewer.controls.target.set(-14.346648304200556, -80.13976481200487, -79.6659983626305);

		let url = "http://localhost:8080/nocommit/eclepens/metadata.json";
		//let url = "http://localhost:8080/nocommit/lion/metadata.json";
		// let url = "http://localhost:8080/nocommit/morro/metadata.json";
		PotreeLoader.load(url).then( async (pointcloud) => {

			window.dbg = pointcloud;

			pointcloud.loader.loadHierarchy(pointcloud.root);
			pointcloud.loader.loadNode(pointcloud.root);

			scene.root.add(pointcloud);
		});

		viewer.addListener("update", (e) => {
			window.debug.fps = Math.round(viewer.fps) + "";
		});

	});

	


</script>



</body>
</html>